{{/* HTML template moved out of Go source. Render with ExecuteTemplate(w, "index.html", data) */}}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador de Patrones (KMP)</title>
    <style>
        body { font-family: sans-serif; background: #f7f7f7; padding: 2rem; }
        h1 { color: #333; }
        form { background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
        input, textarea, button { width: 100%; margin-top: 10px; padding: 8px; }
        button { background: #007BFF; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .result { margin-top: 1.5rem; background: #fff; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
        .suggestion { padding: 6px; cursor: pointer; }
        .suggestion:hover { background: #f0f0f0; }
        .suggestions-container { position: relative; }
        .suggestions-list { position: absolute; left: 0; right: 0; z-index: 100; }
    </style>
</head>
<body>
    <h1>Buscador de Patrones con KMP</h1>
    <form method="POST" action="/">
        <label>Patrón a buscar:</label>
        <div id="suggest-meta" style="font-size:12px;color:#666;margin-top:6px;"></div>
        <div class="suggestions-container">
            <input id="pattern" name="pattern" oninput="fetchSuggestions()" autocomplete="off" value="{{.Pattern}}" placeholder="Ingresa una palabra o frase...">
            <div id="suggestions" class="suggestions-list" style="background:white;border:1px solid #ccc;border-radius:4px;margin-top:6px;"></div>
        </div>
        <button type="submit" style="margin-top:8px;">Buscar</button>
    </form>

    {{if .Positions}}
    <div class="result">
        <h3>Resultados:</h3>
        <p><strong>Patrón:</strong> {{.Pattern}}</p>
        <p><strong>Tiempo:</strong> {{.TimeElapsed}}</p>
        <p><strong>Ocurrencias encontradas:</strong> {{len .Positions}}</p>
        <ul>
        {{range $idx, $pos := .Positions}}
            <li><strong>Posición {{$pos}}:</strong> {{index $.Contexts $idx}}</li>
        {{end}}
        </ul>
    </div>
    {{else if .Result}}
    <div class="result">
        <h3>Resultados:</h3>
        <p><strong>Patrón:</strong> {{.Pattern}}</p>
        <p><strong>Tiempo:</strong> {{.TimeElapsed}}</p>
        <p>{{.Result}}</p>
    </div>
    {{end}}

    <script>
    async function fetchSuggestions() {
      const input = document.querySelector("input[name='pattern']");
      const suggestionsDiv = document.getElementById("suggestions");
      const query = input.value.trim();

      if (query.length === 0) {
        suggestionsDiv.innerHTML = "";
        return;
      }

      try {
        const res = await fetch('/suggest?prefix=' + encodeURIComponent(query));
        if (!res.ok) { suggestionsDiv.innerHTML = ''; return; }
        const data = await res.json();
        const suggestions = data.suggestions || [];

        suggestionsDiv.innerHTML = suggestions
          .slice(0, 5)
          .map(word => `<div class="suggestion">${word}</div>`)
          .join("");

        // mostrar métricas opcionales (por ejemplo dentro del contenedor)
        const meta = document.getElementById('suggest-meta');
        if (meta) {
          meta.textContent = `Tiempo: ${data.duration} · Promedio: ${data.avgMs} ms · Consultas: ${data.count}`;
        }

        document.querySelectorAll(".suggestion").forEach(el => {
          el.addEventListener("click", () => {
            input.value = el.textContent;
            suggestionsDiv.innerHTML = "";
          });
        });
      } catch (err) {
        console.error(err);
        suggestionsDiv.innerHTML = '';
      }
    }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
</body>
</html>